{% extends "base.html" %}

{% block title %} <title>Blog</title> {% endblock %}

{% block content %}

<div class="blog-container">
    <header class="blog-header">
        <h4>Does it echo within you?</h4>
        <h1>Share Your Thoughts</h1>
        {% if current_user.is_admin %}
            <h4><a href="{{ url_for('admin_posts') }}" class="admin-link">Go to Admin Panel</a></h4>
        {% endif %}
    </header>

    <div class="create-post-section">
        <h2>Create a New Post</h2>
        <form action="{{url_for('post')}}" method="POST" class="post-form">
            <input type="text" name="title" placeholder="Post Title" class="form-input" required>
            <textarea name="content" placeholder="What's on your mind, {{ current_user.username }}?" rows="6" class="form-input" required></textarea>
            <button type="submit" class="form-button">Publish Post</button>
        </form>
    </div>

    <div class="posts-section">
        <div class="search-section">
            <form action="{{ url_for('blog') }}" method="GET" class="search-form">
                <input type="text" name="query" placeholder="Search posts..." class="form-input" value="{{ query or '' }}">
                <button type="submit" class="form-button">Search</button>
            </form>
        </div>

        <h2>Recent Posts</h2>
        <div class="posts-list">
            {% for post in posts %}
            <div class="post-item">
                <h3>{{post.title}}</h3>
                <p>{{post.content}}</p>
                <div class="post-meta">
                    Posted by <strong>{{post.author}} on {{ post.timestamp.strftime("%B %d, %Y %I:%M %p") }}</strong>
                </div>
                {% if post.author == current_user.username%}
                <div class="post-actions">
                    <button><a href="{{ url_for('edit_post', post_id=post._id) }}" class="edit-btn">Edit</a></button>
                    <form action="{{ url_for('delete_post', post_id=post._id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?');" style="display: inline;">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% else %}
            <p>No posts found. Try a different search or create a new post!</p>
            {% endfor %}
        </div>

        {# Pagination Links #}
        {% if total_pages > 1 %}
        <nav aria-label="Page navigation" class="pagination-nav">
          <ul class="pagination">
            {# Link to the Previous Page #}
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('blog', page=page-1, query=query) }}">Previous Page</a>
            </li>
         
            {# Link to the Next Page #}
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('blog', page=page+1, query=query) }}">Next Page</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="{{ url_for('blog') }}">Home</a>
            </li>
          </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}