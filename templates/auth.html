{% extends "base.html" %}

{% block title %}
    <title>Authentication</title>
{% endblock %}

{% block content %}

    <main>
        <div class="auth-container">
            <nav class="auth-tabs">
                <div class="auth-tabs-wrapper">
                    <button class="tab-button {% if form == 'login' %}active{% endif %}" data-form="login-form">Login</button>
                    <button class="tab-button {% if form == 'register' %}active{% endif %}" data-form="register-form">Register</button>
                </div>
            </nav>

            <div class="auth-forms">
                <!-- Login Form -->
                <form id="login-form" class="auth-form {% if form == 'login' %}active{% endif %}" method="POST" action="{{ url_for('login') }}">
                    <h2 class="form-title">Welcome Back</h2>
                    <div class="inputs">
                        <input type="text" name="username" class="form-input" placeholder="Username" required>
                        <div class="password-input-container">
                            <input type="password" name="password" class="form-input password-input" placeholder="Password" required>
                            <i class="far fa-eye password-toggle-icon"></i>
                        </div>
                    </div>
                    <div class="form-options">
                        <div class="remember-me">
                            <input type="checkbox" name="remember" id="remember" style="margin-right: 5px;">
                            <label for="remember">Remember Me</label>
                        </div>
                        <a href="{{ url_for('forgot_password') }}">Forgot Password?</a>
                    </div>

                    <button type="submit" class="form-button">Login</button>
                    <div class="google-signin">
                        <a href="{{ url_for('google_login') }}" class="google-button">
                            <img src="https://developers.google.com/identity/images/btn_google_signin_dark_normal_web.png" alt="Sign in with Google">
                        </a>
                    </div>
                    <div class="form-footer">
                        <p>Don't have an account? <a href="#" class="switch-tab" data-form="register-form">Sign up</a></p>
                    </div>
                </form>

                <!-- Registration Form -->
                <form id="register-form" class="auth-form {% if form == 'register' %}active{% endif %}" method="POST" action="{{ url_for('register') }}">
                    <h2 class="form-title">Create Account</h2>
                    <div class="inputs">
                        <input type="text" name="username" class="form-input" placeholder="Username" required>
                        <input type="email" name="email" class="form-input" placeholder="Email" required>
                        <div class="password-input-container">
                            <input type="password" name="password" class="form-input password-input" placeholder="Password" required>
                            <i class="far fa-eye password-toggle-icon"></i>
                        </div>
                    </div>
                    <button type="submit" class="form-button">Register</button>
                    <div class="google-signin">
                        <a href="{{ url_for('google_login') }}" class="google-button">
                            <img src="https://developers.google.com/identity/images/btn_google_signin_dark_normal_web.png" alt="Sign up with Google">
                        </a>
                    </div>
                    <div class="form-footer">
                        <p>Already have an account? <a href="#" class="switch-tab" data-form="login-form">Log in</a></p>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const switchLinks = document.querySelectorAll('.switch-tab');
            const forms = document.querySelectorAll('.auth-form');

            function switchForm(formId) {
                tabButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.form === formId);
                });
                forms.forEach(form => {
                    form.classList.toggle('active', form.id === formId);
                });
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    switchForm(button.dataset.form);
                });
            });

            switchLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchForm(link.dataset.form);
                });
            });

            // Password Toggle Functionality
            const passwordToggles = document.querySelectorAll('.password-toggle-icon');

            passwordToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const passwordInput = this.previousElementSibling;
                    // toggle the type attribute
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    // toggle the eye slash icon
                    this.classList.toggle('fa-eye-slash');
                });
            });

            // Preserve form tab on page reload if specified in URL
            // This is useful for redirects after failed form submissions.
            const currentForm = new URLSearchParams(window.location.search).get('form');
            if (currentForm === 'register') {
                switchForm('register-form');
            } else if (currentForm === 'login') {
                switchForm('login-form');
            } 
        });
    </script>

{% endblock %}