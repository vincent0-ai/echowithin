{% extends "base.html" %}

{% block title %}
<title>{{ title }}</title>
<meta name="description" content="{{ description }}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="blog-header">
        <h1>Welcome, {{ username }}!</h1>
        <p>See what's happening in the community.</p>
        <a href="{{ url_for('blog') }}" class="btn comment-btn"
            style="display: inline-block; margin-top: 1rem; font-size: 1rem; padding: 0.6rem 1.2rem;">Explore The
            Blog</a>
    </div>

    <!-- Daily Quote Section -->
    <div id="zen-quote-container"
        style="display: none; margin: 1.5rem auto; max-width: 600px; padding: 1rem 1.25rem; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-left: 5px solid var(--primary-color); transition: opacity 0.3s ease;">
        <div id="zen-quote-content"
            style="font-style: italic; font-size: 1rem; color: var(--primary-dark-color); margin-bottom: 0.5rem; line-height: 1.5;">
            <!-- Quote text will be injected here -->
        </div>
        <div id="zen-quote-author" style="text-align: right; font-weight: 600; font-size: 0.85rem; color: #555;">
            <!-- Author name will be injected here -->
        </div>
        <div class="quote-attribution" style="margin-top: 0.75rem; font-size: 0.75rem; color: #bbb; text-align: right;">
            <a href="https://zenquotes.io/" target="_blank" rel="noopener noreferrer"
                style="color: #bbb; text-decoration: none; border-bottom: 1px dotted #ccc;">By ZenQuotes API</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('zen-quote-container');
            const content = document.getElementById('zen-quote-content');
            const author = document.getElementById('zen-quote-author');

            fetch('/api/quote')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    if (data && data.text) {
                        content.textContent = '"' + data.text + '"';
                        author.textContent = 'â€” ' + data.author;
                        container.style.display = 'block';
                        // Subtle fade in
                        container.style.opacity = '0';
                        setTimeout(() => {
                            container.style.opacity = '1';
                        }, 50);
                    }
                })
                .catch(error => {
                    console.error('Error fetching ZenQuote:', error);
                });
        });
    </script>

    <!-- Community Stats Section -->
    <section class="community-stats">
        <div class="stat-card">
            <h3>Total Members</h3>
            <p class="stat-number">{{ total_members }}</p>
        </div>
        <div class="stat-card">
            <h3>Total Posts</h3>
            <p class="stat-number">{{ total_posts }}</p>
        </div>
        <div class="stat-card">
            <h3>Most Active Member</h3>
            {% if most_active_member %}
            <p class="stat-text">{{ most_active_member._id }}</p>
            <p class="stat-subtext">with {{ most_active_member.post_count }} posts</p>
            {% else %}
            <p class="stat-subtext">No activity yet.</p>
            {% endif %}
        </div>

        <!-- Trending Posts Card -->
        <div class="stat-card trending-card">
            <h3>Top Posts</h3>
            {% if hot_posts %}
            <ul class="trending-list">
                {% for post in hot_posts %}
                <li>
                    <a href="{{ url_for('view_post', slug=post.slug) }}">{{ post.title }}</a>
                    <span class="stat-subtext">({{ post.comment_count if post.comment_count is defined else 0 }}
                        comments)</span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="stat-subtext">No trending posts right now.</p>
            {% endif %}
        </div>
    </section>
</div>

{# Load Remark42 script to enable comment counters on this page #}
{# Remark42 removed: use server-provided comment_count on posts #}

{% endblock %}