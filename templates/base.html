
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename = "coffee-bean.png")}}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='custom_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = "style.css")}}">
    <script src="{{ url_for('static', filename = "script.js")}}" defer></script>
    <style>
        /* Style for the Remark42 comment counter to make it visible */
        .remark42__counter {
            display: inline-block;
            background-color: #e0e0e0;
            color: #333;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 6px;
        }

        /* Custom Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .custom-modal {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        .custom-modal-content p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #333;
        }
        .custom-modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .custom-modal-actions .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Tag Styles */
        .post-tags {
            margin-top: 10px;
        }
        .tag-badge {
            display: inline-block;
            background-color: #f0f0f0;
            color: #555;
            padding: 4px 8px;
            margin-right: 5px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
    </style>
    <style>
        /* Add padding on mobile for better readability */
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 0 1rem;
            }
        }
    </style>
    <style>
        /* Footer Styles */
        .footer {
            background-color: #f8f9fa;
            color: #6c757d;
            padding: 2rem 1rem;
            text-align: center;
            border-top: 1px solid #e7e7e7;
            margin-top: auto; /* Pushes footer to the bottom */
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        .footer-links {
            margin: 0.5rem 0;
        }
        .footer-links a {
            color: #495057;
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.2s;
        }
        .footer-links a:hover {
            color: #000;
        }
        .footer-socials a {
            font-size: 1.5rem;
        }
    </style>
    {% block title %}<title>Auth</title>{% endblock %}
</head>

<body>
    <div class="page-container">
    <div class="navbar">
        <div class="nav-left">
            <a href="{{ url_for('dashboard') }}" class="nav-brand">
                <img src="{{ url_for('static', filename='logo.jpg') }}" alt="EchoWithin Logo" class="nav-logo">
                EchoWithin
            </a>
            <div class="nav-socials" aria-hidden="false">
                <a href="https://web.facebook.com/profile.php?id=61581191858783" target="_blank" rel="noopener noreferrer" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                <a href="https://www.tiktok.com/@echowithin2025?_t=ZM-8zyR66ekbou&_r=1" target="_blank" rel="noopener noreferrer" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                <a href="https://youtube.com/@echowithin-k9y?si=cvGJDwaxcveOUJuC" target="_blank" rel="noopener noreferrer" title="YouTube"><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
        <nav class="nav-links" id="nav-links">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('home') }}" class="{{ 'active' if active_page == 'home' }}">Home</a>
                <a href="{{ url_for('profile', username=current_user.username) }}" class="{{ 'active' if active_page == 'profile' }}">Profile</a>
                <a href="{{ url_for('blog') }}" class="{{ 'active' if active_page == 'blog' }}">Blog</a>
                <a href="{{ url_for('about') }}" class="{{ 'active' if active_page == 'login' }}">About</a>
                <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('home') }}" class="{{ 'active' if active_page == 'home' }}">Home</a>
                <a href="{{ url_for('login') }}" class="{{ 'active' if active_page == 'login' }}">Login</a>
                <a href="{{ url_for('blog') }}" class="{{ 'active' if active_page == 'blog' }}">Blog</a>
                <a href="{{ url_for('about') }}" class="{{ 'active' if active_page == 'login' }}">About</a>
            {% endif %}
        </nav>
    </div>
    <div class="overlay" id="overlay"></div>
    
    <div class="container">
        <div class="flash-messages">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {%endif%}
    {% endwith%}
    </div>
        {%block content%} {%endblock%}
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="custom-confirm-overlay" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="custom-modal-content">
                <p id="custom-confirm-msg">Are you sure?</p>
            </div>
            <div class="custom-modal-actions">
                <button id="custom-confirm-cancel" class="btn edit-btn">Cancel</button>
                <button id="custom-confirm-ok" class="btn delete-btn">Confirm</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-socials nav-socials" style="margin-bottom: 1rem;">
                <a href="https://web.facebook.com/profile.php?id=61581191858783" target="_blank" rel="noopener noreferrer" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                <a href="https://www.tiktok.com/@echowithin2025?_t=ZM-8zyR66ekbou&_r=1" target="_blank" rel="noopener noreferrer" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                <a href="https://youtube.com/@echowithin-k9y?si=cvGJDwaxcveOUJuC" target="_blank" rel="noopener noreferrer" title="YouTube"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <div class="footer-links">
                <a href="{{ url_for('home') }}">Home</a> | <a href="{{ url_for('blog') }}">Blog</a> | <a href="{{ url_for('about') }}">About</a>
            </div>
            <p>&copy; {{ current_year }} EchoWithin. All Rights Reserved.</p>
        </div>
    </footer>
    </div>
</body>

<script>
    // Wait for the entire page to load before running the script
    window.addEventListener('load', () => {
        // Select all elements with the class 'alert' inside 'flash-messages'
        const flashMessages = document.querySelectorAll('.flash-messages .alert');

        // Set a timeout to make them disappear after 5 seconds
        setTimeout(() => {
            flashMessages.forEach(message => {
                // Add a smooth fade-out transition
                message.style.transition = 'opacity 0.5s ease-out';
                message.style.opacity = '0';
                // After the fade-out, remove the element from the page
                setTimeout(() => {
                    message.remove();
                }, 500); // This should match the transition duration
            });
        }, 3000); // 5000 milliseconds = 5 seconds
    });

    // Script for toggling comment sections on the blog page
    document.addEventListener('DOMContentLoaded', () => {
        const commentToggleButtons = document.querySelectorAll('.toggle-comments-btn');
        const readMoreButtons = document.querySelectorAll('.read-more-btn');

        readMoreButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Find the parent <p> tag
                const parentP = button.closest('p');
                if (parentP) {
                    const truncatedContent = parentP.querySelector('.truncated-content');
                    const fullContent = parentP.querySelector('.full-content');

                    if (fullContent.style.display !== 'none') {
                        // Switch to truncated
                        truncatedContent.style.display = 'inline';
                        fullContent.style.display = 'none';
                        button.textContent = 'Read More';
                    } else {
                        // Switch to full
                        truncatedContent.style.display = 'none';
                        fullContent.style.display = 'inline';
                        button.textContent = 'Read Less';
                    }
                }
            });
        });

        commentToggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                const postId = button.getAttribute('data-post-id');
                const commentsSection = document.getElementById(`comments-${postId}`);

                if (commentsSection) {
                    const isVisible = commentsSection.style.display === 'block';
                    commentsSection.style.display = isVisible ? 'none' : 'block';
                    // Optional: Change button text
                    const commentCount = button.dataset.commentCount;
                    button.textContent = isVisible ? `View ${commentCount} Comment${commentCount != '1' ? 's' : ''}` : 'Hide Comments';
                }
            });
        });

        // Script for "Read More" toggle on the blog page
        const readMoreToggles = document.querySelectorAll('.read-more-toggle');
        readMoreToggles.forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent the link from navigating

                const wrapper = toggle.parentElement;
                const truncated = wrapper.querySelector('.post-content-truncated');
                const full = wrapper.querySelector('.post-content-full');

                const isExpanded = full.style.display === 'block';

                if (isExpanded) {
                    full.style.display = 'none';
                    truncated.style.display = 'block';
                    toggle.innerHTML = 'Read More';
                } else {
                    full.style.display = 'block';
                    truncated.style.display = 'none';
                    toggle.innerHTML = 'Read Less';
                }
            });
        });

        // --- Custom Confirmation Modal Logic ---
        const confirmOverlay = document.getElementById('custom-confirm-overlay');
        const confirmMsg = document.getElementById('custom-confirm-msg');
        const confirmOk = document.getElementById('custom-confirm-ok');
        const confirmCancel = document.getElementById('custom-confirm-cancel');
        let confirmCallback = null;

        function showCustomConfirm(message, callback) {
            confirmMsg.textContent = message;
            confirmOverlay.style.display = 'flex';
            confirmCallback = callback;
        }

        confirmOk.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback(true);
            }
            confirmOverlay.style.display = 'none';
        });

        confirmCancel.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback(false);
            }
            confirmOverlay.style.display = 'none';
        });

        // Close modal if clicking on the overlay
        confirmOverlay.addEventListener('click', (e) => {
            if (e.target === confirmOverlay) confirmCancel.click();
        });

        // --- Event delegation for custom confirms on any form ---
        document.body.addEventListener('submit', function(e) {
            // Target forms for deletion or other confirmation actions
            const form = e.target;
            const confirmMessage = form.getAttribute('data-confirm');
            if (form && confirmMessage) {
                e.preventDefault(); // Stop the form from submitting immediately
                showCustomConfirm(confirmMessage, (confirmed) => {
                    if (confirmed) form.submit(); // If user confirms, submit the form
                });
            }
        });

        // --- Custom Confirmation for Remark42 actions ---
        function addRemark42Confirmations(targetNode) {
            // Selector for Remark42 action buttons (delete, pin, etc.)
            const actionButtons = targetNode.querySelectorAll('.remark42__control-button:not([data-confirm-added])');

            actionButtons.forEach(button => {
                let confirmMessage = '';
                // Determine the message based on the button's class/purpose
                if (button.classList.contains('remark42__control-button_delete')) {
                    confirmMessage = 'Are you sure you want to delete this comment?';
                } else if (button.classList.contains('remark42__control-button_pin')) {
                    // Check if it's already pinned to show the correct message
                    const isPinned = button.closest('.remark42__comment-header_pinned');
                    confirmMessage = isPinned ? 'Are you sure you want to unpin this comment?' : 'Are you sure you want to pin this comment?';
                }

                if (confirmMessage) {
                    button.setAttribute('data-confirm-added', 'true'); // Mark as handled
                    button.addEventListener('click', function(event) {
                        event.preventDefault();
                        event.stopImmediatePropagation();

                        showCustomConfirm(confirmMessage, (confirmed) => {
                            if (confirmed) {
                                // If confirmed, re-trigger the original click event
                                button.removeAttribute('data-confirm-added'); // Allow re-triggering
                                button.click();
                                button.setAttribute('data-confirm-added', 'true'); // Re-mark
                            }
                        });
                    }, true); // Use capture phase to intercept the click first
                }
            });
        }

        // Use MutationObserver to detect when Remark42 comments are loaded/changed
        const remark42Observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => addRemark42Confirmations(mutation.target));
        });
        remark42Observer.observe(document.body, { childList: true, subtree: true });
    });
</script>

{% if remark42_host and remark42_site_id %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remark42 counter configuration
        var remark_config = {
            host: "{{ remark42_host|safe }}",
            site_id: "{{ remark42_site_id|safe }}",
            components: ['counter']
        };

        (function(c) {
            var d = document, s = d.createElement('script');
            s.src = remark_config.host + '/web/' + c[0] + '.js';
            s.defer = true;
            (d.head || d.body).appendChild(s);
        })(remark_config.components || ['embed']); // Default to 'embed' for safety, though 'counter' is primary.

        // New script to fetch and display comment counts for server-rendered posts
        function updateCommentCounts() {
            if (typeof window.REMARK42 === 'undefined' || typeof window.REMARK42.get_counts !== 'function') {
                // If Remark42 API is not ready, wait and try again.
                setTimeout(updateCommentCounts, 200);
                return;
            }

            const counters = document.querySelectorAll('.remark42__counter');
            if (counters.length === 0) return;

            const urls = Array.from(counters).map(counter => counter.getAttribute('data-remark-url'));
            
            window.REMARK42.get_counts(urls)
                .then(counts => {
                    counts.forEach(item => {
                        // Find the corresponding counter span on the page
                        const counterSpan = document.querySelector(`.remark42__counter[data-remark-url="${item.url}"]`);
                        if (counterSpan) {
                            // Update the text of the span with the count
                            counterSpan.textContent = item.count;

                            // Also add the count as a data-attribute to the parent button for potential future use
                            const button = counterSpan.closest('a.comment-btn');
                            if (button) {
                                button.setAttribute('data-comment-count', item.count);
                            }
                        }
                    });
                });
        }
        updateCommentCounts();
    });
</script>
{% endif %}
</html>
